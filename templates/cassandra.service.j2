[Unit]
Description=Cassandra Service
After=docker.service
Requires=docker.socket
 
[Service]
Restart=always
#EnvironmentFile=/etc/cassandra/cassandra.env
EnvironmentFile={{ cassandra_service_environment_path}}/{{ cassandra_service_environment_file }}
ExecStartPre=/bin/bash -c "/usr/bin/docker container inspect ${CASSANDRA_CONTAINER_NAME} 2> /dev/null || /usr/bin/docker run -d --name -p7000-7001 -p7199:7199 -p9042:9042 -p9160:9160 -p9142:9142 -v${CASSANDRA_DATA_PATH}:/var/lib/cassandra -v${CASSANDRA_CONFIG_PATH}/${CASSANDRA_CNFIG_FILE}:/etc/cassandra/cassandra.yaml ${CASSANDRA_CONTAINER_NAME} ${CASSANDRA_IMAGE_REPO}:${CASSANDRA_IMAGE_TAG}"
ExecStart=/usr/bin/docker start -a ${CASSANDRA_CONTAINER_NAME}
ExecStop=/usr/bin/docker stop -t 10 ${CASSANDRA_CONTAINER_NAME} && /usr/bin/docker rm ${CASSANDRA_CONTAINER_NAME}
 
[Install]
WantedBy=multi-user.target
